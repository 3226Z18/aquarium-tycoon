<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title data-i18n="title">æµ·æ—é¦†å¤§äº¨ - ä½ çš„æ·±æµ·ç»è¥æ¨¡æ‹Ÿ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #000814;
            color: #ffffff;
        }

        .aquarium {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 2;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: none; /* ç™»å½•åæ˜¾ç¤º */
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid rgba(144, 224, 239, 0.3);
        }

        .logout-btn {
            background: transparent;
            border: none;
            color: #ff4d4d;
            cursor: pointer;
            font-size: 12px;
            text-decoration: underline;
        }

        .lang-btn {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(144, 224, 239, 0.4);
            background: rgba(255, 255, 255, 0.1);
            color: #90e0ef;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-btn:hover {
            background: rgba(144, 224, 239, 0.2);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
        }
        
        .coins {
            margin-left: 16px;
            font-size: 14px;
            color: #ffd166;
            text-shadow: 0 0 8px rgba(255, 209, 102, 0.5);
        }

        .shop-button {
            padding: 8px 20px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #00b4d8, #0096c7);
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 150, 199, 0.6);
        }

        .shop-button:hover {
            background: linear-gradient(135deg, #48cae4, #0096c7);
        }

        /* æµ·æ´‹èƒŒæ™¯ */
        .sea-background {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #184e77 0%, #1e6091 20%, #1a759f 40%, #168aad 60%, #34a0a4 80%, #52b69a 100%);
            position: relative;
            overflow: hidden;
        }

        /* å¢å¼ºå‹æµ·åº•æ²™åœ° */
        .sea-floor {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 120px;
            background: 
                radial-gradient(circle at 20% 10%, rgba(255, 255, 255, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 30%),
                #d4a373;
            box-shadow: inset 0 30px 40px rgba(0, 0, 0, 0.4);
            border-top: 5px solid #b5832a;
        }

        /* æ²™åœ°çº¹ç†ï¼šå¢åŠ å¤šå±‚æ‚è‰²æ„Ÿ */
        .sea-floor::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: 
                radial-gradient(#b5832a 1px, transparent 1px),
                radial-gradient(#faedcd 1px, transparent 1px);
            background-size: 3px 3px, 7px 7px;
            opacity: 0.4;
        }

        /* è£…é¥°ï¼šæµ·åº•çš„å°å±±ä¸˜ï¼ˆæ›´æœ‰å±‚æ¬¡æ„Ÿï¼‰ */
        .sea-floor::after {
            content: "";
            position: absolute;
            top: -40px;
            left: -10%;
            width: 120%;
            height: 80px;
            background: #d4a373;
            border-radius: 50% 50% 0 0;
            box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.15);
            filter: blur(1px);
        }
                
        .fish-info-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            pointer-events: none;
            z-index: 100; /* ç¡®ä¿åœ¨é±¼è‹—ä¹‹ä¸Š */
        }
                
        .fish-info-overlay.hidden {
            display: none;
        }
                
        .fish-info-panel {
            pointer-events: auto;
            background: rgba(4, 18, 48, 0.98);
            border-radius: 16px;
            padding: 20px;
            width: 380px;
            max-width: 90vw;
            box-shadow: 0 0 50px rgba(0, 180, 216, 0.3);
            border: 1px solid rgba(148, 210, 255, 0.6);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
                
        .fish-info-title {
            font-size: 20px;
            font-weight: bold;
            color: #90e0ef;
            text-align: center;
            border-bottom: 1px solid rgba(144, 224, 239, 0.3);
            padding-bottom: 10px;
        }
                
        .fish-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
                
        .fish-row {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 10px;
        }
                
        .fish-mini {
            width: 40px;
            height: 20px;
            border-radius: 70% 30% 70% 30%;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
                
        .fish-text-main {
            font-size: 15px;
            font-weight: bold;
            color: #ffffff;
        }
                
        .fish-text-sub {
            font-size: 12px;
            color: #caf0f8;
            margin-top: 2px;
        }
                
        .fish-income {
            font-size: 12px;
            color: #ffd166;
            font-weight: bold;
            margin-top: 2px;
        }
                
        .fish-info-close {
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #00b4d8, #0077b6);
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
                
        .fish-info-close:hover {
            filter: brightness(1.1);
            transform: scale(1.02);
        }
                
        /* é€šçŸ¥åŒºåŸŸ */
        .notification-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 110;
            pointer-events: none;
        }
        
        .notification {
            background: rgba(0, 180, 216, 0.9);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 13px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-left: 4px solid #ffd166;
            animation: slideIn 0.3s ease-out, fadeOut 0.5s ease-in 4.5s forwards;
            pointer-events: auto;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(10px); }
        }
        
        /* é±¼è¯¦ç»†æ¡£æ¡ˆå¡ï¼ˆé¼ æ ‡æ‚¬åœæ˜¾ç¤ºï¼‰ */
        .fish-profile-card {
            position: absolute;
            right: 20px;
            top: 100px;
            width: 260px;
            background: rgba(4, 18, 48, 0.95);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(148, 210, 255, 0.4);
            z-index: 600;
            display: none; /* é»˜è®¤éšè— */
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
        }

        .profile-name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(144, 224, 239, 0.3);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
        }

        .xp-bar-bg {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd166, #ff9e00);
            width: 0%;
            transition: width 0.3s;
        }

        .profile-stat {
            font-size: 12px;
            color: #caf0f8;
        }

        .fish {
            position: absolute;
            width: 46px;
            height: 22px;
            background: linear-gradient(135deg, #4cc9f0, #4361ee);
            border-radius: 70% 30% 70% 30%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            opacity: 0.95;
            transition: width 1s ease-in-out, height 1s ease-in-out, filter 1s ease-in-out, transform 0.5s ease-out; 
            z-index: 5;
            pointer-events: auto; /* ç¡®ä¿èƒ½å“åº”é¼ æ ‡äº‹ä»¶ */
            cursor: pointer;
        }
                
        .fish.grown {
            width: 92px; /* åŸå§‹ 46px çš„ 2 å€ */
            height: 44px; /* åŸå§‹ 22px çš„ 2 å€ */
            filter: brightness(1.3);
            z-index: 10;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
        }

        .fish .tail-part {
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 18px;
            transition: all 1s ease-in-out;
        }

        .fish.grown .tail-part {
            width: 32px; /* å°¾å·´ä¹ŸåŒæ­¥æ”¾å¤§ 2 å€ */
            height: 36px;
            right: -18px;
        }
        
        @keyframes swim-new {
            0% {
                left: -200px;
            }
            100% {
                left: 110vw;
            }
        }

        /* å•†åº—é¢æ¿ */
        .shop-panel {
            position: absolute;
            right: 40px;
            top: 60px;
            width: 380px;
            max-width: 90vw;
            background: rgba(4, 18, 48, 0.93);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(148, 210, 255, 0.4);
            z-index: 500; /* è°ƒé«˜ z-index ç¡®ä¿ä¸ä¼šè¢«é±¼æŒ¡ä½ */
            display: flex;
            flex-direction: column;
        }

        .shop-panel.hidden {
            display: none;
        }

        .shop-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(144, 224, 239, 0.4);
        }

        .shop-title {
            font-size: 18px;
            font-weight: bold;
        }

        .close-btn {
            border: none;
            background: transparent;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
        }

        .shop-tabs {
            display: flex;
            padding: 8px;
            gap: 8px;
            border-bottom: 1px solid rgba(144, 224, 239, 0.3);
        }

        .tab-btn {
            flex: 1;
            padding: 6px 4px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            background: transparent;
            color: #90e0ef;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #00b4d8, #0096c7);
            color: #ffffff;
            font-weight: bold;
        }

        .shop-content {
            padding: 12px 14px 14px;
            max-height: 65vh;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .item-card {
            background: rgba(10, 36, 99, 0.85);
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(144, 224, 239, 0.25);
        }

        .item-info {
            max-width: 70%;
        }

        .item-name {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .item-desc {
            font-size: 12px;
            color: #caf0f8;
        }

        .item-price {
            font-size: 13px;
            color: #ffd166;
            margin-top: 2px;
        }

        .buy-btn {
            border: none;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            background: linear-gradient(135deg, #ffd166, #ff9e00);
            color: #3a0ca3;
            font-weight: bold;
        }

        .buy-btn:active {
            transform: scale(0.96);
        }

        /* bait tab å ä½ */
        .coming-soon {
            text-align: center;
            padding: 30px 10px;
            font-size: 14px;
            color: #caf0f8;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ–ä¸€ç‚¹ç‚¹ */
        .shop-content::-webkit-scrollbar {
            width: 6px;
        }

        .shop-content::-webkit-scrollbar-thumb {
            background: rgba(144, 224, 239, 0.6);
            border-radius: 3px;
        }

        /* é±¼é¥µæ ·å¼ */
        .bait {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ff9e00;
            border-radius: 50%;
            box-shadow: 0 0 5px #ffd166;
            z-index: 4;
            pointer-events: none;
        }

        /* è¿›é£Ÿç¢å±‘ */
        .crumb {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #e9c46a;
            border-radius: 50%;
            z-index: 4;
            pointer-events: none;
            opacity: 0.8;
        }

        /* ç®€å•é€‚é…å°å± */
        @media (max-width: 520px) {
            .shop-panel {
                left: 10px;
                right: 10px;
                width: auto;
            }
        }

        /* --- è´¦å·ç³»ç»Ÿ UI --- */
        #authOverlay {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: radial-gradient(circle at center, #001d3d 0%, #000814 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        #authOverlay.hidden {
            display: none;
        }

        .auth-card {
            background: rgba(4, 18, 48, 0.95);
            padding: 40px;
            border-radius: 24px;
            width: 360px;
            box-shadow: 0 0 50px rgba(0, 180, 216, 0.4);
            border: 1px solid rgba(148, 210, 255, 0.3);
            text-align: center;
            animation: cardEntrance 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes cardEntrance {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .auth-logo {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(to bottom, #fff, #90e0ef);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .auth-subtitle {
            font-size: 14px;
            color: #caf0f8;
            margin-bottom: 30px;
            opacity: 0.7;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-input {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(144, 224, 239, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 16px;
        }

        .auth-btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .auth-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b4d8, #0077b6);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #90e0ef;
            border: 1px solid rgba(144, 224, 239, 0.2);
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.1);
        }

        .auth-msg {
            margin-top: 15px;
            font-size: 13px;
            color: #ff9e00;
            min-height: 20px;
        }
    </style>
</head>
<body>
<div id="authOverlay">
    <div class="auth-card">
        <div class="auth-logo" data-i18n="logo">æµ·æ—é¦†å¤§äº¨</div>
        <div class="auth-subtitle" data-i18n="subtitle">å¼€å¯ä½ çš„æ·±æµ·ç»è¥ä¹‹æ—…</div>
        <div class="auth-form">
            <input type="text" id="usernameInput" class="auth-input" placeholder="è¯·è¾“å…¥è´¦å·å..." data-i18n-placeholder="username_placeholder">
            <input type="password" id="passwordInput" class="auth-input" placeholder="è¯·è¾“å…¥å¯†ç ..." data-i18n-placeholder="password_placeholder">
            <div class="auth-btn-group">
                <button class="auth-btn btn-secondary" id="registerBtn" data-i18n="register_btn">å»ºç«‹è´¦å·</button>
                <button class="auth-btn btn-primary" id="loginBtn" data-i18n="login_btn">ç™»å½•æ¸¸æˆ</button>
            </div>
            <div class="auth-msg" id="authMsg"></div>
        </div>
    </div>
</div>

<div class="aquarium">
    <div class="header">
        <div class="header-left">
            <div class="logo" data-i18n="logo">æµ·æ—é¦†å¤§äº¨</div>
            <div class="user-info" id="userInfo">
                <span data-i18n="owner">é¦†ä¸»: </span><span id="currentUserName">---</span>
                <button class="logout-btn" id="logoutBtn" data-i18n="logout">æ³¨é”€</button>
            </div>
        </div>
        <div class="header-right">
            <div class="coins"><span data-i18n="coins_label">é‡‘å¸ï¼š</span><span id="coinsAmount">$100</span></div>
            <button class="shop-button" id="openShopBtn" data-i18n="shop_btn">Shop</button>
            <button class="lang-btn" id="langBtn">EN</button>
        </div>
    </div>

    <div class="sea-background">
        <div class="sea-floor"></div>
        <div class="notification-container" id="notificationContainer"></div>
        
        <!-- é±¼è¯¦ç»†æ¡£æ¡ˆå¡ -->
        <div class="fish-profile-card" id="fishProfileCard">
            <input type="text" class="profile-name-input" id="profileNameInput" value="é±¼å">
            <div class="profile-stat" id="profileRarity"><span data-i18n="rarity_label">ç¨€æœ‰åº¦: </span><span id="profileRarityText">æ™®é€š</span></div>
            <div class="profile-stat" id="profileGrowth"><span data-i18n="status_label">çŠ¶æ€: </span><span id="profileGrowthText">é±¼è‹—</span></div>
            <div class="profile-stat" data-i18n="xp_label">ç»éªŒå€¼ (XP)</div>
            <div class="xp-bar-bg">
                <div class="xp-bar-fill" id="profileXPFill"></div>
            </div>
            <div class="profile-stat" id="profileIncomeLabel"><span id="incomePrefix" data-i18n="income_after_label">æˆé•¿åæ”¶ç›Š: </span><span id="profileIncomeValue">???</span></div>
        </div>

        <div class="fish-info-overlay hidden" id="fishInfoOverlay">
            <div class="fish-info-panel">
                <div class="fish-info-title" id="fishInfoTitle"></div>
                <div class="fish-list" id="fishList"></div>
                <button class="fish-info-close" id="fishInfoCloseBtn" data-i18n="close_btn">å…³é—­</button>
            </div>
        </div>
    </div>

    <div class="shop-panel hidden" id="shopPanel">
        <div class="shop-header">
            <div class="shop-title" data-i18n="shop_btn">æµ·æ—é¦†å•†åº—</div>
            <button class="close-btn" id="closeShopBtn">âœ•</button>
        </div>

        <div class="shop-tabs">
            <button class="tab-btn active" data-tab="fry" data-i18n="tab_fry">é±¼è‹—åŒ…</button>
            <button class="tab-btn" data-tab="decor" data-i18n="tab_decor">è£…é¥°</button>
            <button class="tab-btn" data-tab="bait" data-i18n="tab_bait">é±¼é¥µå’Œæ°´ç¼¸</button>
        </div>

        <div class="shop-content">
            <!-- é±¼è‹—åŒ… -->
            <div class="tab-content active" id="tab-fry">
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="pack_basic">ğŸŸ åŸºç¡€é±¼è‹—åŒ…</div>
                        <div class="item-desc" data-desc-id="pack_basic_desc">é€‚åˆæ–°æ‰‹çš„å°é±¼ç»„åˆã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$100</div>
                    </div>
                    <button class="buy-btn" data-name="åŸºç¡€é±¼è‹—åŒ…" data-price="100" data-type="fish" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="pack_lux">ğŸ  è±ªåé±¼è‹—åŒ…</div>
                        <div class="item-desc" data-desc-id="pack_lux_desc">åŒ…å«å¤šç§ç¨€æœ‰é±¼è‹—ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$1M</div>
                    </div>
                    <button class="buy-btn" data-name="è±ªåé±¼è‹—åŒ…" data-price="1000000" data-type="fish" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="pack_top">ğŸ¡ é¡¶çº§é±¼è‹—åŒ…</div>
                        <div class="item-desc" data-desc-id="pack_top_desc">æœ‰æœºä¼šè·å¾—ä¼ è¯´ä¸­çš„é±¼ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$100M</div>
                    </div>
                    <button class="buy-btn" data-name="é¡¶çº§é±¼è‹—åŒ…" data-price="100000000" data-type="fish" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="pack_cos">ğŸ‹ å®‡å®™çº§é±¼è‹—åŒ…</div>
                        <div class="item-desc" data-desc-id="pack_cos_desc">æå…¶ç¨€æœ‰ï¼Œåªç»™æœ€è±ªçš„é¦†ä¸»ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$1T</div>
                    </div>
                    <button class="buy-btn" data-name="å®‡å®™çº§é±¼è‹—åŒ…" data-price="1000000000000" data-type="fish" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="pack_ulti">ğŸ‰ ç»ˆæÂ·ä¸€äº¬é±¼è‹—åŒ…</div>
                        <div class="item-desc" data-desc-id="pack_ulti_desc">ä¼ è¯´ä¸­çš„ç»ˆæé±¼è‹—ç»„åˆã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$10Qa</div>
                    </div>
                    <button class="buy-btn" data-name="ç»ˆæÂ·ä¸€äº¬é±¼è‹—åŒ…" data-price="10000000000000000" data-type="fish" data-i18n="buy_btn">è´­ä¹°</button>
                </div>
            </div>

            <!-- è£…é¥° -->
            <div class="tab-content" id="tab-decor">
                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="bg_light">ğŸŒ¤ æµ…æµ·æ—¥å…‰èƒŒæ™¯</div>
                        <div class="item-desc" data-desc-id="bg_light_desc">é˜³å…‰é€è¿›æ¥çš„æµ…è“è‰²æµ·é¢ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$1K</div>
                    </div>
                    <button class="buy-btn" data-name="æµ…æµ·æ—¥å…‰èƒŒæ™¯" data-price="1000" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="bg_coral">ğŸª¸ çŠç‘šç¤ä¹å›­èƒŒæ™¯</div>
                        <div class="item-desc" data-desc-id="bg_coral_desc">äº”å½©ç¼¤çº·çš„çŠç‘šä¸å°é±¼ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$10K</div>
                    </div>
                    <button class="buy-btn" data-name="çŠç‘šç¤ä¹å›­èƒŒæ™¯" data-price="10000" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="bg_star">ğŸŒŒ æ·±æµ·æ˜Ÿå…‰èƒŒæ™¯</div>
                        <div class="item-desc" data-desc-id="bg_star_desc">å¹½è“æ·±æµ·ï¼Œä»¿ä½›å¸ƒæ»¡æ˜Ÿæ˜Ÿã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$100K</div>
                    </div>
                    <button class="buy-btn" data-name="æ·±æµ·æ˜Ÿå…‰èƒŒæ™¯" data-price="100000" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="decor_arch">ğŸ° çŠç‘šæ‹±é—¨è£…é¥°</div>
                        <div class="item-desc" data-desc-id="decor_arch_desc">è®©é±¼ä»æ‹±é—¨ä¸­ç©¿æ¢­è€Œè¿‡ã€‚</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$5K</div>
                    </div>
                    <button class="buy-btn" data-name="çŠç‘šæ‹±é—¨è£…é¥°" data-price="5000" data-i18n="buy_btn">è´­ä¹°</button>
                </div>

                <div class="item-card">
                    <div class="item-info">
                        <div class="item-name" data-item-id="decor_chest">ğŸ§° ç¥ç§˜å®ç®±è£…é¥°</div>
                        <div class="item-desc" data-desc-id="decor_chest_desc">ä¼šä¸ä¼šè—ç€æ›´å¤šé‡‘å¸ï¼Ÿ</div>
                        <div class="item-price"><span data-i18n="price_label">ä»·æ ¼ï¼š</span>$50K</div>
                    </div>
                    <button class="buy-btn" data-name="ç¥ç§˜å®ç®±è£…é¥°" data-price="50000" data-i18n="buy_btn">è´­ä¹°</button>
                </div>
            </div>

            <!-- é±¼é¥µå’Œæ°´ç¼¸ï¼šå…ˆå ä½ -->
            <div class="tab-content" id="tab-bait">
                <div class="coming-soon" data-i18n="coming_soon">
                    é±¼é¥µå’Œæ°´ç¼¸ç³»ç»Ÿ<br />
                    è¿˜åœ¨è®¾è®¡ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï½
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const fishPacks = {
        "åŸºç¡€é±¼è‹—åŒ…": [
            { id: "basic1", name: "æå…‰å‰‘é±¼", desc: "å°¾éƒ¨æ‹–ç€å…‰ç—•çš„é«˜é€Ÿæ é£Ÿè€…ã€‚", income: 1, growth: "10ç§’", growthSec: 10, color: "linear-gradient(135deg, #4cc9f0, #4361ee)", tail: "polygon(0 50%, 100% 0, 100% 100%)" },
            { id: "basic2", name: "éœå…‰é³é²¤", desc: "åœ¨æ°´é¢é™„è¿‘æ‚ é—²å·¡æ¸¸çš„å°å‹é±¼ã€‚", income: 2, growth: "20ç§’", growthSec: 20, color: "linear-gradient(135deg, #ff9e00, #ff006e)", tail: "polygon(0 20%, 100% 50%, 0 80%)" },
            { id: "basic3", name: "å¹½è“æ»‘é³", desc: "å¤œæ™šä¼šå¾®å¾®å‘å…‰çš„å®‰é™é±¼ç±»ã€‚", income: 3, growth: "30ç§’", growthSec: 30, color: "linear-gradient(135deg, #7209b7, #3f37c9)", tail: "polygon(0 0, 100% 50%, 0 100%)" },
            { id: "basic4", name: "é“¶å½±å¿«é³", desc: "ä¸€é—ªè€Œè¿‡å°±æ¶ˆå¤±åœ¨æ°´è‰ä¹‹é—´ã€‚", income: 4, growth: "45ç§’", growthSec: 45, color: "linear-gradient(135deg, #e0e1dd, #778da9)", tail: "polygon(0 50%, 100% 20%, 100% 80%)" },
            { id: "basic5", name: "æ™¨æ›¦èŠ±çº¹é±¼", desc: "èº«ä¸Šæœ‰æ·¡æ·¡äº‘çŠ¶èŠ±çº¹ã€‚", income: 5, growth: "1åˆ†é’Ÿ", growthSec: 60, color: "linear-gradient(135deg, #f9c74f, #90be6d)", tail: "circle(50% at 50% 50%)" },
        ],
        "è±ªåé±¼è‹—åŒ…": [
            { id: "lux1", name: "æ˜Ÿç¯åˆƒé±¼", desc: "èº«ä½“å‘¨å›´æœ‰æ·¡æ·¡æ˜Ÿç¯å…‰å¸¦ã€‚", income: 20, growth: "2åˆ†é’Ÿ", growthSec: 120, color: "linear-gradient(135deg, #480ca8, #4cc9f0)", tail: "polygon(0 50%, 100% 0, 100% 100%)" },
            { id: "lux2", name: "æ·±æ¸Šæµæ˜Ÿé²¨", desc: "åƒæµæ˜Ÿä¸€æ ·åˆ’è¿‡æ·±æµ·ã€‚", income: 30, growth: "3åˆ†é’Ÿ", growthSec: 180, color: "linear-gradient(135deg, #03045e, #0077b6)", tail: "polygon(0 30%, 100% 50%, 0 70%)" },
            { id: "lux3", name: "éœœç¿¼é¾™é³", desc: "é³è¾¹ç¼˜ä»¿ä½›è¦†ç›–ç€å†°éœœã€‚", income: 40, growth: "5åˆ†é’Ÿ", growthSec: 300, color: "linear-gradient(135deg, #caf0f8, #00b4d8)", tail: "polygon(20% 0, 100% 50%, 20% 100%)" },
            { id: "lux4", name: "çŠç‘šç‹å† é±¼", desc: "å¤´é¡¶å½¢çŠ¶åƒä¸€åœˆç‹å† ã€‚", income: 50, growth: "8åˆ†é’Ÿ", growthSec: 480, color: "linear-gradient(135deg, #f72585, #b5179e)", tail: "polygon(0 50%, 100% 10%, 100% 90%)" },
            { id: "lux5", name: "é»æ˜ç ´æ™“é²”", desc: "æ—¥å‡ºæ—¶æœ€æ´»è·ƒçš„æ•é£Ÿè€…ã€‚", income: 60, growth: "10åˆ†é’Ÿ", growthSec: 600, color: "linear-gradient(135deg, #fb8500, #ffb703)", tail: "polygon(0 40%, 100% 50%, 0 60%)" },
        ],
        "é¡¶çº§é±¼è‹—åŒ…": [
            { id: "top1", name: "è™šç©ºæ£±é•œé±¼", desc: "èº«ä½“åƒé€æ˜æ£±é•œæŠ˜å°„å…‰çº¿ã€‚", income: 120, growth: "20åˆ†é’Ÿ", growthSec: 1200, color: "linear-gradient(135deg, #bde0fe, #ffafcc)", tail: "polygon(0 50%, 100% 0, 100% 100%)" },
            { id: "top2", name: "é›·éœ†è£‚é³", desc: "æ¸¸åŠ¨æ—¶å°¾éƒ¨å¸¦ç€ç”µå¼§æ®‹å½±ã€‚", income: 150, growth: "30åˆ†é’Ÿ", growthSec: 1800, color: "linear-gradient(135deg, #fee440, #00f5d4)", tail: "polygon(0 0, 100% 50%, 0 100%)" },
            { id: "top3", name: "å¹»å…‰é¾™é²¸", desc: "ä¼˜é›…è€Œå·¨å¤§çš„è¿œå¤æ·±æµ·ç”Ÿç‰©ã€‚", income: 200, growth: "1å°æ—¶", growthSec: 3600, color: "linear-gradient(135deg, #9b5de5, #f15bb5)", tail: "polygon(0 50%, 100% 10%, 100% 90%)" },
            { id: "top4", name: "æ˜Ÿäº‘æ¸¸è›‡é±¼", desc: "èº«åæ‹–ç€æ˜Ÿäº‘èˆ¬çš„å°¾è¿¹ã€‚", income: 260, growth: "1.5å°æ—¶", growthSec: 5400, color: "linear-gradient(135deg, #00bbf9, #00f5d4)", tail: "polygon(10% 20%, 100% 50%, 10% 80%)" },
            { id: "top5", name: "æ—¶å…‰å›å£°é±¼", desc: "æ®è¯´èƒ½åœ¨æ°´ä¸­ç•™ä¸‹çŸ­æš‚çš„å€’å½±ã€‚", income: 300, growth: "2å°æ—¶", growthSec: 7200, color: "linear-gradient(135deg, #8338ec, #3a86ff)", tail: "polygon(0 50%, 80% 0, 100% 50%, 80% 100%)" },
        ],
        "å®‡å®™çº§é±¼è‹—åŒ…": [
            { id: "cos1", name: "é»‘æ´ä¹‹ç³", desc: "ä¸­å¿ƒå¦‚åŒä¸€æšå¾®ç¼©é»‘æ´ã€‚", income: 800, growth: "5å°æ—¶", growthSec: 18000, color: "linear-gradient(135deg, #000000, #4361ee)", tail: "circle(50% at 50% 50%)" },
            { id: "cos2", name: "æ˜ŸèŠ’è£‚ç•Œé²¨", desc: "é³å°–æ‹–ç€æ˜ŸèŠ’ç¢ç‰‡ã€‚", income: 1000, growth: "8å°æ—¶", growthSec: 28800, color: "linear-gradient(135deg, #4895ef, #4cc9f0)", tail: "polygon(0 50%, 100% 0, 100% 100%)" },
            { id: "cos3", name: "å¯°å®‡è½¨é“é±¼", desc: "èº«è¾¹æ€»æœ‰å‡ æšå°å…‰ç‚¹ç¯ç»•ã€‚", income: 1200, growth: "12å°æ—¶", growthSec: 43200, color: "linear-gradient(135deg, #7209b7, #f72585)", tail: "polygon(0 20%, 100% 50%, 0 80%)" },
            { id: "cos4", name: "æ·±ç©ºç”µå…‰é³", desc: "ç”µæµåœ¨é³ç‰‡é—´æµåŠ¨ã€‚", income: 1500, growth: "18å°æ—¶", growthSec: 64800, color: "linear-gradient(135deg, #3a0ca3, #4cc9f0)", tail: "polygon(0 50%, 100% 10%, 100% 90%)" },
            { id: "cos5", name: "è™šå®äº¤ç•Œé²¸", desc: "èº«ä½“ä»¿ä½›åœ¨ç°å®ä¸è™šç©ºé—´é—ªçƒã€‚", income: 2000, growth: "24å°æ—¶", growthSec: 86400, color: "linear-gradient(135deg, #4361ee, #bde0fe)", tail: "polygon(10% 0, 100% 50%, 10% 100%)" },
        ],
        "ç»ˆæÂ·ä¸€äº¬é±¼è‹—åŒ…": [
            { id: "ulti1", name: "æ°¸æ’ç‹åº§é±¼", desc: "åªä¼šä¾å¥‰æœ€å¼ºå¤§çš„é¦†ä¸»ã€‚", income: 10000, growth: "2å¤©", growthSec: 172800, color: "linear-gradient(135deg, #ffd700, #ff8c00)", tail: "polygon(0 50%, 100% 0, 100% 100%)" },
            { id: "ulti2", name: "ç»´åº¦è£‚éš™é¾™", desc: "æ¸¸åŠ¨æ—¶èº«åç•™ä¸‹ä¸€é“ç©ºé—´è£‚ç¼ã€‚", income: 15000, growth: "3å¤©", growthSec: 259200, color: "linear-gradient(135deg, #4b0082, #9400d3)", tail: "polygon(0 0, 100% 50%, 0 100%)" },
            { id: "ulti3", name: "åˆ›ä¸–å…‰è½®é²¸", desc: "ä¼ è¯´ç›®ç¹å®ƒä¼šå¸¦æ¥å¥½è¿ã€‚", income: 20000, growth: "5å¤©", growthSec: 432000, color: "linear-gradient(135deg, #ffffff, #ffd700)", tail: "circle(50% at 50% 50%)" },
            { id: "ulti4", name: "å¯°å®‡ç»ˆç„‰é²¨", desc: "æ°”åœºå‹è¿«æ„Ÿæå¼ºçš„é¡¶çº§æ é£Ÿè€…ã€‚", income: 30000, growth: "7å¤©", growthSec: 604800, color: "linear-gradient(135deg, #333333, #ff0000)", tail: "polygon(0 30%, 100% 50%, 0 70%)" },
            { id: "ulti5", name: "æ— é™å›å“é±¼", desc: "é³ç‰‡ä¸Šåˆ»ç€æœªçŸ¥æ–‡å­—ã€‚", income: 50000, growth: "14å¤©", growthSec: 1209600, color: "linear-gradient(135deg, #00ff00, #0000ff)", tail: "polygon(0 50%, 100% 20%, 100% 80%)" },
        ],
    };

    function formatCoinsShort(value) {
        const abs = Math.abs(value);
        const units = [
            { v: 1e18, s: "Qi" },
            { v: 1e15, s: "Qa" },
            { v: 1e12, s: "T" },
            { v: 1e9,  s: "B" },
            { v: 1e6,  s: "M" },
            { v: 1e3,  s: "K" },
        ];
        for (const u of units) {
            if (abs >= u.v) {
                const num = value / u.v;
                const fixed = num >= 10 ? num.toFixed(0) : num.toFixed(2);
                return `${fixed}${u.s}`;
            }
        }
        return `${value}`;
    }

    function formatCoinsWithSymbol(value) {
        return `$${formatCoinsShort(value)}`;
    }

    function updateCoinsDisplay() {
        if (coinsAmountSpan) {
            coinsAmountSpan.textContent = formatCoinsWithSymbol(coins);
        }
    }

    function showNotification(message) {
        if (!notificationContainer) return;
        const note = document.createElement("div");
        note.className = "notification";
        note.textContent = message;
        notificationContainer.appendChild(note);
        setTimeout(() => { note.remove(); }, 5000);
    }

    let currentLang = "zh";
    const translations = {
        zh: {
            title: "æµ·æ—é¦†å¤§äº¨ - ä½ çš„æ·±æµ·ç»è¥æ¨¡æ‹Ÿ",
            logo: "æµ·æ—é¦†å¤§äº¨",
            subtitle: "å¼€å¯ä½ çš„æ·±æµ·ç»è¥ä¹‹æ—…",
            username_placeholder: "è¯·è¾“å…¥è´¦å·å...",
            password_placeholder: "è¯·è¾“å…¥å¯†ç ...",
            register_btn: "å»ºç«‹è´¦å·",
            login_btn: "ç™»å½•æ¸¸æˆ",
            owner: "é¦†ä¸»: ",
            logout: "æ³¨é”€",
            coins_label: "é‡‘å¸ï¼š",
            shop_btn: "å•†åº—",
            rarity_label: "ç¨€æœ‰åº¦: ",
            status_label: "çŠ¶æ€: ",
            xp_label: "ç»éªŒå€¼ (XP)",
            income_after_label: "æˆé•¿åæ”¶ç›Š: ",
            income_label: "æ”¶ç›Š: ",
            close_btn: "å…³é—­",
            tab_fry: "é±¼è‹—åŒ…",
            tab_decor: "è£…é¥°",
            tab_bait: "é±¼é¥µå’Œæ°´ç¼¸",
            price_label: "ä»·æ ¼ï¼š",
            buy_btn: "è´­ä¹°",
            coming_soon: "é±¼é¥µå’Œæ°´ç¼¸ç³»ç»Ÿè¿˜åœ¨è®¾è®¡ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï½",
            rarity_common: "æ™®é€š",
            rarity_rare: "ç¨€æœ‰",
            rarity_epic: "å²è¯—",
            rarity_legend: "ä¼ è¯´",
            status_fry: "é±¼è‹—",
            status_adult: "å·²æˆå¹´",
            msg_welcome: "æ¬¢è¿å›æ¥ï¼Œ{u}ï¼æ¸¸æˆå·²åŠ è½½ã€‚",
            msg_logout: "å·²å®‰å…¨æ³¨é”€ã€‚",
            msg_grown: "ğŸ‰ ä½ çš„ã€Œ{n}ã€å·²ç»é•¿å¤§äº†ï¼",
            msg_auto_bait_on: "ğŸ— è‡ªåŠ¨æŠ•å–‚ï¼šå·²å¼€å¯ (2ä¸ª/ç§’)",
            msg_auto_bait_off: "ğŸš« è‡ªåŠ¨æŠ•å–‚ï¼šå·²å…³é—­",
            msg_no_login_bait: "è¯·å…ˆç™»å½•æ¸¸æˆåå†æŠ•å–‚é±¼å„¿å“¦ï¼",
            msg_no_login_buy: "è¯·å…ˆç™»å½•æ¸¸æˆåå†è´­ä¹°ç‰©å“å“¦ï¼",
            confirm_logout: "ç¡®å®šè¦æ³¨é”€å¹¶ä¿å­˜è¿›åº¦å—ï¼Ÿ",
            pack_basic: "ğŸŸ åŸºç¡€é±¼è‹—åŒ…",
            pack_basic_desc: "é€‚åˆæ–°æ‰‹çš„å°é±¼ç»„åˆã€‚",
            pack_lux: "ğŸ  è±ªåé±¼è‹—åŒ…",
            pack_lux_desc: "åŒ…å«å¤šç§ç¨€æœ‰é±¼è‹—ã€‚",
            pack_top: "ğŸ¡ é¡¶çº§é±¼è‹—åŒ…",
            pack_top_desc: "æœ‰æœºä¼šè·å¾—ä¼ è¯´ä¸­çš„é±¼ã€‚",
            pack_cos: "ğŸ‹ å®‡å®™çº§é±¼è‹—åŒ…",
            pack_cos_desc: "æå…¶ç¨€æœ‰ï¼Œåªç»™æœ€è±ªçš„é¦†ä¸»ã€‚",
            pack_ulti: "ğŸ‰ ç»ˆæÂ·ä¸€äº¬é±¼è‹—åŒ…",
            pack_ulti_desc: "ä¼ è¯´ä¸­çš„ç»ˆæé±¼è‹—ç»„åˆã€‚",
            bg_light: "ğŸŒ¤ æµ…æµ·æ—¥å…‰èƒŒæ™¯",
            bg_light_desc: "é˜³å…‰é€è¿›æ¥çš„æµ…è“è‰²æµ·é¢ã€‚",
            bg_coral: "ğŸª¸ çŠç‘šç¤ä¹å›­èƒŒæ™¯",
            bg_coral_desc: "äº”å½©ç¼¤çº·çš„çŠç‘šä¸å°é±¼ã€‚",
            bg_star: "ğŸŒŒ æ·±æµ·æ˜Ÿå…‰èƒŒæ™¯",
            bg_star_desc: "å¹½è“æ·±æµ·ï¼Œä»¿ä½›å¸ƒæ»¡æ˜Ÿæ˜Ÿã€‚",
            decor_arch: "ğŸ° çŠç‘šæ‹±é—¨è£…é¥°",
            decor_arch_desc: "è®©é±¼ä»æ‹±é—¨ä¸­ç©¿æ¢­è€Œè¿‡ã€‚",
            decor_chest: "ğŸ§° ç¥ç§˜å®ç®±è£…é¥°",
            decor_chest_desc: "ä¼šä¸ä¼šè—ç€æ›´å¤šé‡‘å¸ï¼Ÿ"
        },
        en: {
            title: "Aquarium Tycoon - Deep Sea Sim",
            logo: "Aquarium Tycoon",
            subtitle: "Start your deep sea journey",
            username_placeholder: "Username...",
            password_placeholder: "Password...",
            register_btn: "Sign Up",
            login_btn: "Login",
            owner: "Owner: ",
            logout: "Logout",
            coins_label: "Coins: ",
            shop_btn: "Shop",
            rarity_label: "Rarity: ",
            status_label: "Status: ",
            xp_label: "Experience (XP)",
            income_after_label: "Grown Income: ",
            income_label: "Income: ",
            close_btn: "Close",
            tab_fry: "Fish Packs",
            tab_decor: "Decor",
            tab_bait: "Bait & Tanks",
            price_label: "Price: ",
            buy_btn: "Buy",
            coming_soon: "Bait and tank system is under design, stay tuned~",
            rarity_common: "Common",
            rarity_rare: "Rare",
            rarity_epic: "Epic",
            rarity_legend: "Legend",
            status_fry: "Fry",
            status_adult: "Adult",
            msg_welcome: "Welcome back, {u}! Game loaded.",
            msg_logout: "Safe logout successful.",
            msg_grown: "ğŸ‰ Your '{n}' has grown up!",
            msg_auto_bait_on: "ğŸ— Auto-feed: ON (2/sec)",
            msg_auto_bait_off: "ğŸš« Auto-feed: OFF",
            msg_no_login_bait: "Please login to feed the fish!",
            msg_no_login_buy: "Please login to buy items!",
            confirm_logout: "Are you sure you want to logout and save?",
            pack_basic: "ğŸŸ Basic Pack",
            pack_basic_desc: "Starter pack for beginners.",
            pack_lux: "ğŸ  Deluxe Pack",
            pack_lux_desc: "Contains various rare fish.",
            pack_top: "ğŸ¡ Top-tier Pack",
            pack_top_desc: "Chance to get legendary fish.",
            pack_cos: "ğŸ‹ Cosmic Pack",
            pack_cos_desc: "Extremely rare for rich owners.",
            pack_ulti: "ğŸ‰ Ultimate Pack",
            pack_ulti_desc: "The legendary final combination.",
            bg_light: "ğŸŒ¤ Shallow Sunlight",
            bg_light_desc: "Light blue sea with sunlight.",
            bg_coral: "ğŸª¸ Coral Paradise",
            bg_coral_desc: "Colorful corals and fish.",
            bg_star: "ğŸŒŒ Deep Sea Starlight",
            bg_star_desc: "Dark blue with twinkling stars.",
            decor_arch: "ğŸ° Coral Arch",
            decor_arch_desc: "Let fish swim through the arch.",
            decor_chest: "ğŸ§° Mystery Chest",
            decor_chest_desc: "Might contain more coins?"
        }
    };

    function updateLanguage() {
        document.querySelectorAll("[data-i18n]").forEach(el => {
            const key = el.dataset.i18n;
            if (translations[currentLang][key]) {
                el.textContent = translations[currentLang][key];
            }
        });
        document.querySelectorAll("[data-i18n-placeholder]").forEach(el => {
            const key = el.dataset.i18nPlaceholder;
            if (translations[currentLang][key]) {
                el.placeholder = translations[currentLang][key];
            }
        });
        document.getElementById("langBtn").textContent = currentLang === "zh" ? "EN" : "CN";
        if (activeFish) updateProfileCard(activeFish);
    }

    document.getElementById("langBtn").addEventListener("click", () => {
        currentLang = currentLang === "zh" ? "en" : "zh";
        updateLanguage();
    });

    const openShopBtn = document.getElementById("openShopBtn");
    const closeShopBtn = document.getElementById("closeShopBtn");
    const shopPanel = document.getElementById("shopPanel");

    openShopBtn.addEventListener("click", () => {
        shopPanel.classList.remove("hidden");
    });

    closeShopBtn.addEventListener("click", () => {
        shopPanel.classList.add("hidden");
    });

    const tabButtons = document.querySelectorAll(".tab-btn");
    const tabContents = {
        fry: document.getElementById("tab-fry"),
        decor: document.getElementById("tab-decor"),
        bait: document.getElementById("tab-bait")
    };

    tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            tabButtons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");

            const tabName = btn.getAttribute("data-tab");
            Object.keys(tabContents).forEach(key => {
                tabContents[key].classList.toggle("active", key === tabName);
            });
        });
    });

    let coins = 100;
    const coinsAmountSpan = document.getElementById("coinsAmount");
    const seaBackground = document.querySelector(".sea-background");
    const fishInfoOverlay = document.getElementById("fishInfoOverlay");
    const fishInfoTitle = document.getElementById("fishInfoTitle");
    const fishList = document.getElementById("fishList");
    const fishInfoCloseBtn = document.getElementById("fishInfoCloseBtn");
    const notificationContainer = document.getElementById("notificationContainer");
    
    // --- è´¦å·ç³»ç»Ÿé€»è¾‘ ---
    let currentUser = null;
    let autoSaveInterval = null;
    const authOverlay = document.getElementById("authOverlay");
    const usernameInput = document.getElementById("usernameInput");
    const passwordInput = document.getElementById("passwordInput");
    const loginBtn = document.getElementById("loginBtn");
    const registerBtn = document.getElementById("registerBtn");
    const authMsg = document.getElementById("authMsg");
    const userInfo = document.getElementById("userInfo");
    const currentUserName = document.getElementById("currentUserName");
    const logoutBtn = document.getElementById("logoutBtn");

    function getStorage() {
        return JSON.parse(localStorage.getItem("aquarium_users") || "{}");
    }

    function saveToStorage(users) {
        localStorage.setItem("aquarium_users", JSON.stringify(users));
    }

    registerBtn.addEventListener("click", () => {
        const u = usernameInput.value.trim();
        const p = passwordInput.value.trim();
        if (!u || !p) return authMsg.textContent = "è´¦å·æˆ–å¯†ç ä¸èƒ½ä¸ºç©ºï¼";
        
        const users = getStorage();
        if (users[u]) return authMsg.textContent = "è¯¥è´¦å·åå·²è¢«æ³¨å†Œï¼";
        
        users[u] = {
            password: p,
            coins: 100,
            ownedFishIds: [],
            grownFishIds: [],
            fishInstances: [] 
        };
        saveToStorage(users);
        authMsg.style.color = "#00f5d4";
        authMsg.textContent = "å»ºç«‹è´¦å·æˆåŠŸï¼è¯·ç›´æ¥ç™»å½•ã€‚";
        // è‡ªåŠ¨å¡«å¥½è´¦å·åï¼Œæ–¹ä¾¿ç™»å½•
        usernameInput.value = u;
        passwordInput.value = "";
        passwordInput.focus();
    });

    loginBtn.addEventListener("click", () => {
        const u = usernameInput.value.trim();
        const p = passwordInput.value.trim();
        const users = getStorage();
        
        if (!users[u]) {
            authMsg.style.color = "#ff4d4d";
            authMsg.textContent = currentLang === "zh" ? "è¯¥è´¦å·ä¸å­˜åœ¨ï¼" : "Account does not exist!";
            return;
        }
        
        if (users[u].password === p) {
            currentUser = u;
            loadGame(users[u]);
            authOverlay.classList.add("hidden");
            userInfo.style.display = "flex";
            currentUserName.textContent = u;
            const welcome = (translations[currentLang].msg_welcome).replace("{u}", u);
            showNotification(welcome);
            startAutoSave();
        } else {
            authMsg.style.color = "#ff4d4d";
            authMsg.textContent = currentLang === "zh" ? "å¯†ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥å¤§å°å†™ï¼" : "Wrong password! Check casing.";
        }
    });

    logoutBtn.addEventListener("click", () => {
        if (confirm(translations[currentLang].confirm_logout)) {
            performSave();
            currentUser = null;
            if (autoSaveInterval) clearInterval(autoSaveInterval);
            document.querySelectorAll(".fish").forEach(f => f.remove());
            baits.forEach(b => b.remove());
            baits.length = 0;
            authOverlay.classList.remove("hidden");
            userInfo.style.display = "none";
            coins = 100;
            updateCoinsDisplay();
            showNotification(translations[currentLang].msg_logout);
        }
    });

    function loadGame(userData) {
        coins = userData.coins || 100;
        updateCoinsDisplay();
        ownedFishIds.clear();
        (userData.ownedFishIds || []).forEach(id => ownedFishIds.add(id));
        grownFishIds.clear();
        (userData.grownFishIds || []).forEach(id => grownFishIds.add(id));
        
        document.querySelectorAll(".fish").forEach(f => f.remove());
        
        if (userData.fishInstances) {
            userData.fishInstances.forEach(inst => {
                let fishData = findFishDataById(inst.id);
                if (fishData) {
                    const isGrown = inst.isGrown === "true";
                    let currentWidth = parseFloat(inst.width) || 40;
                    // å¦‚æœå·²ç»é•¿å¤§ï¼Œå­˜æ¡£é‡Œçš„ width æ˜¯ originalSize * 2
                    const baseSize = isGrown ? currentWidth / 2 : currentWidth;
                    
                    createFish(
                        fishData, 
                        baseSize, 
                        inst.left, 
                        inst.top, 
                        parseInt(inst.xp) || 0, 
                        isGrown, 
                        inst.name
                    );
                }
            });
        }
    }

    function findFishDataById(id) {
        for (const pack of Object.values(fishPacks)) {
            const found = pack.find(f => f.id === id);
            if (found) return found;
        }
        return null;
    }

    function startAutoSave() {
        if (autoSaveInterval) clearInterval(autoSaveInterval);
        autoSaveInterval = setInterval(performSave, 3000);
    }

    function performSave() {
        if (!currentUser) return;
        const users = getStorage();
        const userData = users[currentUser];
        
        userData.coins = coins;
        userData.ownedFishIds = Array.from(ownedFishIds);
        userData.grownFishIds = Array.from(grownFishIds);
        
        const instances = [];
        document.querySelectorAll(".fish").forEach(f => {
            instances.push({
                id: f.dataset.id,
                name: f.dataset.name,
                xp: f.dataset.xp,
                isGrown: f.dataset.isGrown,
                width: f.style.width,
                height: f.style.height,
                top: f.style.top,
                left: f.style.left
            });
        });
        userData.fishInstances = instances;
        
        users[currentUser] = userData;
        saveToStorage(users);
    }

    // --- æ ¸å¿ƒé±¼ç±»é€»è¾‘é‡æ„ ---

    const ownedFishIds = new Set();
    const grownFishIds = new Set(); 

    function createFish(fishData, size, x, y, xp = 0, isGrown = false, name = null) {
        const fish = document.createElement("div");
        fish.className = "fish";
        if (isGrown) fish.classList.add("grown");
        
        fish.style.background = fishData.color;
        fish.style.width = (isGrown ? size * 2 : size) + "px";
        fish.style.height = (isGrown ? size : size / 2) + "px";
        fish.style.left = x || (Math.random() * 80 + "%");
        fish.style.top = y || (20 + Math.random() * 60 + "%");
        
        fish.dataset.id = fishData.id;
        fish.dataset.name = name || fishData.name;
        fish.dataset.income = fishData.income;
        fish.dataset.xp = xp;
        fish.dataset.targetXp = fishData.growthSec;
        fish.dataset.isGrown = isGrown ? "true" : "false";

        const tail = document.createElement("div");
        tail.className = "tail-part";
        tail.style.background = fishData.color;
        tail.style.clipPath = fishData.tail;
        fish.appendChild(tail);

        seaBackground.appendChild(fish);
        initFishLogic(fish, fishData, size);
        return fish;
    }

    function initFishLogic(fish, fishData, originalSize) {
        // æ¸¸åŠ¨ AI
        function startMoving() {
            if (!fish.parentNode) return;
            
            const detectedBait = findNearbyBait(fish);
            let targetX, targetY, moveDuration;
            const isGrown = fish.dataset.isGrown === "true";

            if (detectedBait) {
                if (!isGrown) {
                    targetX = parseFloat(detectedBait.style.left);
                    targetY = parseFloat(detectedBait.style.top);
                    moveDuration = 0.5 + Math.random() * 0.5;
                    fish.dataset.isTargetingBait = "true";
                } else {
                    const bx = parseFloat(detectedBait.style.left);
                    const by = parseFloat(detectedBait.style.top);
                    targetX = bx + (Math.random() * 10 - 5);
                    targetY = by + (Math.random() * 10 - 5);
                    moveDuration = 2 + Math.random() * 2;
                    fish.dataset.isTargetingBait = "true";
                }
            } else {
                targetX = Math.random() * 90;
                targetY = 20 + Math.random() * 60;
                moveDuration = 4 + Math.random() * 6;
                fish.dataset.isTargetingBait = "false";
            }

            const currentX = parseFloat(fish.style.left) || 0;
            if (targetX > currentX) {
                fish.style.transform = "scaleX(-1)";
            } else {
                fish.style.transform = "scaleX(1)";
            }

            requestAnimationFrame(() => {
                fish.style.transition = `left ${moveDuration}s linear, top ${moveDuration}s linear, transform 0.5s ease-out, width 1s ease-in-out, height 1s ease-in-out`;
                fish.style.left = targetX + "%";
                fish.style.top = targetY + "%";
            });

            fish.moveTimeout = setTimeout(startMoving, moveDuration * 1000);
        }

        setTimeout(startMoving, 100);

        // è¿›é£Ÿæ£€æµ‹ä¸ XP è‡ªåŠ¨å¢é•¿
        const interactionInt = setInterval(() => {
            if (!fish.parentNode) return clearInterval(interactionInt);
            
            const isGrown = fish.dataset.isGrown === "true";
            
            // è‡ªåŠ¨ä¾¦æµ‹é±¼é¥µä»¥æ”¹å˜èˆªå‘
            if (fish.dataset.isTargetingBait === "false" && baits.length > 0) {
                if (findNearbyBait(fish)) {
                    clearTimeout(fish.moveTimeout);
                    startMoving();
                }
            }

            // ç¢°æ’è¿›é£Ÿ
            const fishRect = fish.getBoundingClientRect();
            for (let i = baits.length - 1; i >= 0; i--) {
                const b = baits[i];
                const baitRect = b.getBoundingClientRect();
                if (fishRect.left < baitRect.right && fishRect.right > baitRect.left && 
                    fishRect.top < baitRect.bottom && fishRect.bottom > baitRect.top) {
                    if (!isGrown) {
                        createCrumbs(parseFloat(b.style.left), parseFloat(b.style.top));
                        b.remove();
                        baits.splice(i, 1);
                        updateXP(fish, fishData, originalSize, 5);
                        clearTimeout(fish.moveTimeout);
                        startMoving();
                        break;
                    }
                }
            }
        }, 150);

        // XP éšæ—¶é—´å¢é•¿
        const xpInt = setInterval(() => {
            if (!fish.parentNode || fish.dataset.isGrown === "true") return clearInterval(xpInt);
            updateXP(fish, fishData, originalSize, 1);
        }, 1000);

        // äº¤äº’
        fish.addEventListener("click", (e) => {
            e.stopPropagation();
            isPinned = true;
            activeFish = fish;
            updateProfileCard(fish);
            fishProfileCard.style.display = "flex";
        });
        fish.addEventListener("mouseenter", () => { 
            if (!isPinned) { 
                activeFish = fish; 
                updateProfileCard(fish); 
                fishProfileCard.style.display = "flex"; 
            } 
        });
        fish.addEventListener("mouseleave", (e) => { 
            if (!isPinned && !fishProfileCard.contains(e.relatedTarget)) { 
                activeFish = null; 
                fishProfileCard.style.display = "none"; 
            } 
        });
    }

    function updateXP(fish, fishData, originalSize, amount) {
        if (fish.dataset.isGrown === "true") return;
        let xp = parseInt(fish.dataset.xp) + amount;
        fish.dataset.xp = xp;
        if (activeFish === fish) updateProfileCard(fish);
        if (xp >= parseInt(fish.dataset.targetXp)) {
            triggerGrowth(fish, fishData, originalSize);
        }
    }

    function triggerGrowth(fish, fishData, originalSize) {
        if (fish.dataset.isGrown === "true") return;
        fish.dataset.isGrown = "true";
        fish.classList.add("grown");
        fish.style.width = (originalSize * 2) + "px";
        fish.style.height = (originalSize) + "px";
        if (!grownFishIds.has(fishData.id)) {
            grownFishIds.add(fishData.id);
            const msg = (translations[currentLang].msg_grown).replace("{n}", fishData.name);
            showNotification(msg);
        }
    }

    function findNearbyBait(fish) {
        if (baits.length === 0) return null;
        const fishX = parseFloat(fish.style.left) || 0;
        const fishY = parseFloat(fish.style.top) || 0;
        let nearestBait = null;
        let minDistance = 25; // æ¢æµ‹èŒƒå›´
        baits.forEach(b => {
            const dist = Math.sqrt(Math.pow(fishX - parseFloat(b.style.left), 2) + Math.pow(fishY - parseFloat(b.style.top), 2));
            if (dist < minDistance) { minDistance = dist; nearestBait = b; }
        });
        return nearestBait;
    }

    let activeFish = null;
    let isPinned = false; // æ˜¯å¦ç‚¹å‡»å›ºå®šäº†æ¡£æ¡ˆå¡
    const fishProfileCard = document.getElementById("fishProfileCard");

    // é±¼é¥µé€»è¾‘
    const baits = [];
    let isBaiting = false;
    let baitDropInterval = null;
    let lastMousePos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };

    seaBackground.addEventListener("click", (e) => {
        if (e.target.classList.contains("fish") || e.target.closest(".fish") || 
            e.target.closest(".shop-panel") || e.target.closest(".fish-info-overlay") || 
            e.target.closest(".fish-profile-card") || e.target.closest(".header")) {
            return;
        }

        if (!currentUser) {
            showNotification(translations[currentLang].msg_no_login_bait);
            authOverlay.classList.remove("hidden");
            return;
        }

        isBaiting = !isBaiting;
        
        if (isBaiting) {
            lastMousePos = { x: e.clientX, y: e.clientY };
            spawnBaitAtCurrentMouse();
            if (baitDropInterval) clearInterval(baitDropInterval);
            baitDropInterval = setInterval(() => {
                spawnBaitAtCurrentMouse();
            }, 500);
            showNotification(translations[currentLang].msg_auto_bait_on);
        } else {
            if (baitDropInterval) {
                clearInterval(baitDropInterval);
                baitDropInterval = null;
            }
            showNotification(translations[currentLang].msg_auto_bait_off);
        }
    });

    seaBackground.addEventListener("mousemove", (e) => {
        lastMousePos = { x: e.clientX, y: e.clientY };
    });

    function spawnBaitAtCurrentMouse() {
        if (!isBaiting) return;
        const x = (lastMousePos.x / window.innerWidth) * 100;
        const y = (lastMousePos.y / window.innerHeight) * 100;
        spawnBait(x, y);
    }

    function spawnBait(x, y) {
        // ç»´æŒé±¼é¥µæ•°é‡ä¸Šé™ï¼Œé¿å…æ€§èƒ½é—®é¢˜
        if (baits.length >= 200) {
            const oldest = baits.shift();
            if (oldest) oldest.remove();
        }

        const b = document.createElement("div");
        b.className = "bait";
        b.style.left = x + "%";
        b.style.top = y + "%";
        seaBackground.appendChild(b);
        baits.push(b);

        // é±¼é¥µä¸‹æ²‰é€»è¾‘
        let currentY = y;
        const fallInterval = setInterval(() => {
            if (!b.parentNode) {
                clearInterval(fallInterval);
                return;
            }
            currentY += 0.25; // ç¨å¾®è°ƒå¿«ä¸€ç‚¹ä¸‹æ²‰é€Ÿåº¦
            b.style.top = currentY + "%";

            if (currentY > 92) { // æ²‰åˆ°æ²™åœ°é™„è¿‘æ¶ˆå¤±
                b.remove();
                const idx = baits.indexOf(b);
                if (idx > -1) baits.splice(idx, 1);
                clearInterval(fallInterval);
            }
        }, 40);
    }

    function createCrumbs(x, y) {
        for (let i = 0; i < 5; i++) {
            const c = document.createElement("div");
            c.className = "crumb";
            c.style.left = x + "%";
            c.style.top = y + "%";
            seaBackground.appendChild(c);

            let curY = y;
            let curX = x + (Math.random() * 2 - 1);
            let opacity = 0.8;
            
            const crumbInterval = setInterval(() => {
                curY += 0.5;
                opacity -= 0.05;
                c.style.top = curY + "%";
                c.style.left = curX + "%";
                c.style.opacity = opacity;
                
                if (opacity <= 0 || curY > 98) {
                    c.remove();
                    clearInterval(crumbInterval);
                }
            }, 60);
        }
    }

    // ç‚¹å‡»èƒŒæ™¯å–æ¶ˆå›ºå®š
    document.addEventListener("click", (e) => {
        const isClickInsideCard = fishProfileCard.contains(e.target);
        const isClickOnFish = e.target.classList.contains("fish") || e.target.closest(".fish");
        
        if (!isClickInsideCard && !isClickOnFish) {
            isPinned = false;
            activeFish = null;
            fishProfileCard.style.display = "none";
        }
    });

    // æ”¶ç›Šå¾ªç¯é€»è¾‘
    setInterval(() => {
        let totalIncome = 0;
        const allFish = document.querySelectorAll(".fish");
        allFish.forEach(f => {
            if (f.dataset.isGrown === "true") {
                totalIncome += parseInt(f.dataset.income || 0);
            }
        });
        
        if (totalIncome > 0) {
            coins += totalIncome;
            updateCoinsDisplay();
        }
    }, 1000);
    const profileNameInput = document.getElementById("profileNameInput");
    const profileRarityText = document.getElementById("profileRarityText");
    const profileGrowthText = document.getElementById("profileGrowthText");
    const profileXPFill = document.getElementById("profileXPFill");
    const profileIncomeValue = document.getElementById("profileIncomeValue");
    const incomePrefix = document.getElementById("incomePrefix");

    function updateProfileCard(fish) {
        if (!fish) return;
        profileNameInput.value = fish.dataset.name;
        
        let rarityKey = fish.dataset.id.startsWith("basic") ? "rarity_common" : 
                       fish.dataset.id.startsWith("lux") ? "rarity_rare" :
                       fish.dataset.id.startsWith("top") ? "rarity_epic" : "rarity_legend";
        profileRarityText.textContent = translations[currentLang][rarityKey];
        
        const isGrown = fish.dataset.isGrown === "true";
        profileGrowthText.textContent = isGrown ? translations[currentLang].status_adult : translations[currentLang].status_fry;
        
        const xp = parseInt(fish.dataset.xp);
        const targetXp = parseInt(fish.dataset.targetXp);
        const percent = Math.min(100, (xp / targetXp) * 100);
        profileXPFill.style.width = percent + "%";

        if (isGrown || grownFishIds.has(fish.dataset.id)) {
            incomePrefix.textContent = translations[currentLang].income_label;
            profileIncomeValue.textContent = `$${fish.dataset.income}/s`;
        } else {
            incomePrefix.textContent = translations[currentLang].income_after_label;
            profileIncomeValue.textContent = "??? $";
        }
    }

    profileNameInput.addEventListener("input", () => {
        if (activeFish) {
            activeFish.dataset.name = profileNameInput.value;
        }
    });

    fishProfileCard.addEventListener("mouseleave", () => {
        activeFish = null;
        fishProfileCard.style.display = "none";
    });
    
    const buyButtons = document.querySelectorAll(".buy-btn");
    buyButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            if (!currentUser) {
                alert(translations[currentLang].msg_no_login_buy);
                authOverlay.classList.remove("hidden");
                return;
            }
            const name = btn.getAttribute("data-name");
            const price = btn.getAttribute("data-price");
            const type = btn.getAttribute("data-type") || "";
            const priceValue = Number(price);
    
            if (Number.isNaN(priceValue)) return;
    
            if (coins >= priceValue) {
                coins -= priceValue;
                updateCoinsDisplay();
    
                if (type === "fish") {
                    buildFishInfo(name);
                    markFishOwned(name);
                    addFishPack(name);
                }
            } else {
                const have = formatCoinsWithSymbol(coins);
                const need = formatCoinsWithSymbol(priceValue);
                if (currentLang === "zh") {
                    alert(`é‡‘å¸ä¸å¤Ÿå“¦ï¼éœ€è¦ï¼š${need}ï¼Œä½ åªæœ‰ï¼š${have}ã€‚`);
                } else {
                    alert(`Not enough coins! Need: ${need}, You have: ${have}.`);
                }
            }
        });
    });

    function addFishPack(packName) {
        if (!seaBackground) return;
        const pack = fishPacks[packName];
        if (!pack) return;
    
        pack.forEach(fishData => {
            const size = 32 + Math.random() * 10;
            createFish(fishData, size);
        });
    }

    function buildFishInfo(packName) {
        const pack = fishPacks[packName];
        if (!pack || !fishInfoOverlay || !fishList || !fishInfoTitle) return;
    
        fishInfoTitle.textContent = `${packName} - ç»„åˆé±¼ä»‹ç»`;
        fishList.innerHTML = "";
    
        pack.forEach(fish => {
            const row = document.createElement("div");
            row.className = "fish-row";
    
            const icon = document.createElement("div");
            icon.className = "fish-mini";
            icon.style.background = fish.color;
            const miniTail = document.createElement("div");
            miniTail.style.position = "absolute";
            miniTail.style.right = "-6px";
            miniTail.style.top = "50%";
            miniTail.style.transform = "translateY(-50%)";
            miniTail.style.width = "8px";
            miniTail.style.height = "10px";
            miniTail.style.background = fish.color;
            miniTail.style.clipPath = fish.tail;
            icon.appendChild(miniTail);
    
            const textBox = document.createElement("div");
            const main = document.createElement("div");
            main.className = "fish-text-main";
            main.textContent = fish.name;
    
            const sub = document.createElement("div");
            sub.className = "fish-text-sub";
            sub.textContent = `${fish.desc} (æˆé•¿æ—¶é—´: ${fish.growth})`;
    
            const income = document.createElement("div");
            income.className = "fish-income";
            const isGrown = grownFishIds.has(fish.id);
            if (isGrown) {
                income.textContent = `æˆé•¿åæ”¶ç›Š: ${formatCoinsWithSymbol(fish.income)}/ç§’`;
            } else {
                income.textContent = "æˆé•¿åæ”¶ç›Š: ??? $";
            }
    
            textBox.appendChild(main);
            textBox.appendChild(sub);
            textBox.appendChild(income);
    
            row.appendChild(icon);
            row.appendChild(textBox);
            fishList.appendChild(row);
        });
        fishInfoOverlay.classList.remove("hidden");
    }

    function markFishOwned(packName) {
        const pack = fishPacks[packName];
        if (!pack) return;
        pack.forEach(fish => ownedFishIds.add(fish.id));
    }

    if (fishInfoCloseBtn && fishInfoOverlay) {
        fishInfoCloseBtn.addEventListener("click", () => {
            fishInfoOverlay.classList.add("hidden");
        });
    }

    updateCoinsDisplay();
</script>
</body>
</html>